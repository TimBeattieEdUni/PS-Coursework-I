##############################################################################
#  Makefile for directory "test".  Builds unit test using the class library.
#



##############################################################################
#  Include project-global definitions.

include ../Makefile.inc



##############################################################################
#  Header include directories.

INCLUDE = -I../classes -isystem ../$(TESTLIBDIR)/src



##############################################################################
#  Source, objects, and header dependencies.

SOURCE  = *.cpp
OBJS    = $(patsubst %.cpp,%.o,$(wildcard $(SOURCE)))
DEPS    = $(OBJS:.o=.d)



##############################################################################
#  Unit test library flags.

TESTLIBFLAGS  = -L../UnitTest++ -lUnitTest++



##############################################################################
#  Primary target rules.

default: release

.PHONY: release
release: $(TESTAPP)

.PHONY: debug
debug: $(TESTAPP)

.PHONY: clean
clean:
	rm -f $(DEPS)
	rm -f $(OBJS)
	rm -f $(TESTAPP)


#--------------------------
# Autogenerated header dependencies
#--------------------------

-include $(DEPS)


#--------------------------
# Pattern rules
#--------------------------

%.o : %.cpp
	$(CXX) -c $(CXXFLAGS) $(INCLUDE) $(WARNINGS) -MMD -o $@ $<


#--------------------------
# Binary rules
#--------------------------

$(TESTAPP): $(OBJS)
	$(CXX) -o $(TESTAPP) $(OBJS) $(CLASSLIBFLAG) $(TESTLIBFLAGS) $(LIBS)
